# ویژگی‌های جدید Mars SysPro Universal

## 📏 تنظیم عرض کاغذ (Paper Width Formatting)

### تنظیمات:
در فایل `config.json`:
```json
{
  "printer": {
    "paper_width": 80  // یا 58 میلی‌متر
  }
}
```

### قابلیت‌ها:
- **کاغذ 80 میلی‌متری**: حداکثر 48 کاراکتر در هر خط
- **کاغذ 58 میلی‌متری**: حداکثر 32 کاراکتر در هر خط
- **تقسیم خودکار**: خطوط طولانی به صورت خودکار تقسیم می‌شوند

---

## 🌐 مانیتورینگ اتصال اینترنت

### قابلیت‌ها:
- **چک خودکار**: هر 5 ثانیه اتصال اینترنت چک می‌شود
- **آلارم قطعی**: در صورت قطع اینترنت آلارم پخش می‌شود
- **وصل شدن مجدد**: تا زمان وصل شدن مجدد تلاش می‌کند
- **رفرش خودکار**: پس از وصل شدن صفحه رفرش می‌شود
- **توقف آلارم**: آلارم به صورت خودکار متوقف می‌شود

### لاگ‌ها:
```
🚨 Internet connection lost!
🔔 Internet alarm started
✅ Internet connection restored!
🔇 Internet alarm stopped
🔄 WebView page refreshed
```

---

## 🏥 Health Check صفحه WebView

### تنظیمات:
در فایل `config.json`:
```json
{
  "app_url": "http://localhost:3001/order-reception.html"
}
```

### قابلیت‌ها:
- **چک خودکار**: هر 10 ثانیه سلامت صفحه چک می‌شود
- **پیام خطا**: در صورت عدم دسترسی پیام قرمز نمایش داده می‌شود
- **رفرش خودکار**: پس از بهبود وضعیت صفحه رفرش می‌شود
- **پوشش کامل**: پیام خطا کل صفحه را می‌پوشد

### پیام خطا:
```
⚠️ سیستم قطع است
در حال تلاش برای وصل شدن...
```

### لاگ‌ها:
```
🚨 WebView health check failed!
🚨 System error overlay displayed
✅ WebView health restored!
🔄 WebView error cleared and refreshed
```

---

## 🔧 API Endpoints جدید

### وضعیت سیستم:
```bash
curl -X GET http://localhost:8080/api/status
```

### چاپ با فرمت‌بندی:
```bash
curl -X POST http://localhost:8080/api/print \
  -H "Content-Type: application/json" \
  -d '{"text":"متن طولانی که خودکار فرمت می‌شود..."}'
```

---

## ⚙️ نحوه استفاده

### 1. تنظیم عرض کاغذ:
- فایل `config.json` را ویرایش کنید
- `paper_width` را به 80 یا 58 تغییر دهید
- برنامه را مجدداً اجرا کنید

### 2. مانیتورینگ:
- به صورت خودکار شروع می‌شود
- هیچ تنظیم اضافی نیاز نیست
- لاگ‌ها در کنسول نمایش داده می‌شود

### 3. URL اپلیکیشن:
- فایل `config.json` را ویرایش کنید
- `app_url` را به آدرس صحیح تغییر دهید
- برنامه را مجدداً اجرا کنید

---

## 🔄 Cleanup خودکار

- هنگام بستن برنامه همه thread ها متوقف می‌شوند
- آلارم به صورت خودکار قطع می‌شود
- هیچ process باقی نمی‌ماند

---

## ✅ تست ویژگی‌ها

### تست عرض کاغذ:
```bash
# متن طولانی برای تست تقسیم خطوط
curl -X POST http://localhost:8080/api/print \
  -d '{"text":"این خط خیلی طولانی است و باید تقسیم شود"}'
```

### تست قطع اینترنت:
- اتصال اینترنت را قطع کنید
- آلارم باید شروع شود
- اتصال را برقرار کنید
- آلارم باید متوقف شود

### تست Health Check:
- سرور اپلیکیشن را متوقف کنید
- پیام خطا باید نمایش داده شود
- سرور را مجدداً اجرا کنید
- صفحه باید رفرش شود
